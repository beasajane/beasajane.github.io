计算机网络
=========

计算机是人发明的
--------------

# 用上帝视角看网络结构
  * 与送快递有很多相似之处
  分层（跨层次之间没有联系）、分成部分（平级关系）

# 计算机网络是典型的**分层结构**，也是理解分层模型的示例 （五层、七层）
  * 物理层
  * 链路层 send(data, address)， 在两台直接相连的设备之前收发数据
  * 网络层 send(data, ip)， 在网络中的任意两台设备间手法数据（点对点的单项传输）
  * 传输层 tcp，在两个应用程序间收发数据
    * 会话层
    * 表示层
  * 应用层
  ```
  把每一次对应一系列的函数
  应用层只调用传输层的函数
  传输层只调用网络层的函数
  一次类推
  ```
  计算机网络为啥要分层？
  复杂系统基本上都会分层。
  分层的好处是什么？
  会让复杂的系统更好维护，控制。

  网购
  服务：快递服务
  运输： 汽车，火车，飞机
  道路： 公路，铁路
  基础架构： 基建，科技
  材料
  物理化学
  原子分子

  * * 分层与物理层
  发件人：
  收件人：

#  物理层
  * 指设备之间的物理链接
    * 可以是有线
      * 网线 （橙白 橙 绿白 蓝 蓝白 绿 棕白 棕）绿白 蓝 蓝白 绿有屏蔽效果
      * 光纤
    * 可以是无线
      * WiFi
      * 4G
      * 5G
  * 物理层解决信号的调制与解调
    * 即数字信号与模拟信号之间的转换与传输
  * 保证通信的两端能够理解01
  * 把上层给到的数据转换为表示01的模拟信号传到电缆上
  * 把从电缆接收到的数据转换为01
  * 物理层还需要考虑
    * 信号的时钟同步
      * 为此使用了能够同步时钟信号的编码
        * 即曼彻斯特编码（差分曼彻斯特编码）及其变种
    * 电压（流）的大小
  速率:  1M bits per second
  RTT: Round Trip Time (往返时间 )

  数据包在不同协议中的叫法不一样
  链路层： 帧 frame
  网络层： packet 数据包
  TCP：segment 数据段
  UDP：datagram 数据报

# 链路层 （交换机属于链路层设备）
  * 链路层仅负责直接链接的设备间的通信
    * 实际上真正的网络通信也都是能过局域网一步步传出去的
  * 只关心直接链接的机器之间的以字节为单位的通信
  * 广播域（多台直接连接的设备组成一个广播域 有限局域网络可以广播 红蜘蛛，网线未接好，，会掉帧） 
    * 每个设备起名一个地址(MAC地址 只能在局域网中用
        六个字节6byte  
        win-r cmd ipconfig /all
        物理地址. . . . . . . . . . . . . : 6C-02-E0-90-B3-26
        linux  sudo ifconfig
        )
  * 集线器
  * 不同方式下链路层的实现有很多
    * 以太网
      * 载波侦听多路访问
      * 用了交换机之后，基本不存在载波侦听多路访问
    * WiFi
      * 载波侦听多路访问
      * GRPS，3G, 4G
  * 目前最广泛使用的就是以太网
    * 它的标准拓扑结构为总线型
      * 总线型
  * 在这一层，每个网卡会有一个全球唯一的MAC（Media Access Control Address) 地址，用来表示这个设备的ID， 虽然在局域网内使用，但这个ID仍然是唯一的
  * 局域网之间的通信是通过MAC地址的，而非IP地址(IP地址是指互联网协议地址（Internet Protocol Address），是IP Address的缩写)
      <!-- // MAC地址又称为物理地址、硬件地址，用来定义网络设备的位置。 -->
    * Address Resolution Protocol 链路层主要协议之一
  * 交换机就是典型的链路层设备 （也称二层设备）
    * 三层交换机，并不运行在三层，也不做任何三层的事情
    * 只是会识别ip地址等数据包里的三层包头来执行相关的策略
  * arp欺骗，网络风暴，广播风暴
  * ping 要关掉关防火墙
  * 链路层连接方式
      总线型网络（集线器的本质 物理层设备 不识别数据     交换机是二层设备链路层设备，可以识别经过它的数据包里的数据，包含每台电脑的MAC地址）
      环形网络(令牌环 网络效率低 )
  
# 网络层(IP层)  提供平邮（只提供send（data， ip）函数 无get（）ip尝试把数据发送到指定的地址，）
  * 网络层把IP数据包（Packet）从起始机器送达到目标机器 （**不需要直接连接 一步一步转发**）
    * Best Effort
  * 路由器
    * 真正的路由器，而非家用路由器
    * 家用路由器其实是NAT路由
  * 瘦腰模型
    * SPL，货币
  * NAT网络地址转换
  * IP地址的分类
    * A类 子网掩码长度为8
    * B类 子网掩码长度为16
    * C类 子网掩码长度为24
  * 特殊IP地址：
    * 127.* 永远指向当前计算机（电脑上必须有网卡）
    * 0.0.0.0 代表当前机器的所有地址，当前机器还没有获取到IP地址时，代表自己的地址（DHCP）
    * 255.255.255.255 广播地址
    * x.y.255.255 特定网域的广播地址
    * 10.* 预留的用于局域网的A类地址
    * 172.xxx 预留的用于局域网的B类地址
    * 192.168.* 预留的用于局域网的C类地址
    * 244-239.*.*.* 多播地址，类似与频道，一般只在局域网中使用
  <!-- 网络号 主机号 （全1代表广播地址，全0代表广播本身） -->

  IP地址，子网掩码与子网的划分

  不关心是局域网还是关于王
    * 如果是局域网，下层会通过ARP协议把IP转换为MAC地址
  路由器会根据网络结构选择如何转发分组
    * 公众路由协议
    * 路由表
  * DHCP服务器 Dynamic Host Configuration Protocal  动态主机配置协议  
    * 问题 两台机器都能提供IP地址配置信息，选哪个。（需要告知选哪个）
  * VPN一般是在这一层 virtual private network（一根虚拟的网线插到了远程机房中 加密 为企业级服务） （划水提升自己）
    * 抽象成一个网卡 数据加密
    * 一般的VPN连接后电脑会多出一个IP地址
    * VPN某种程度上相当于把网线查到VPN目标所在的位置
  * tarcert
  * ICMP协议
  * IPv6
  * 带宽 *** bps
  * 延迟 x
  * 域名来源

  ip地址 子网掩码 默认网关之间的关系
  总线（交换机）  路由器

  <!-- 抓包软件（wireshark） ：可抓到网卡上面经过的所有的数据 -->

  DNs 服务器 (域名 Domai name: www.baidu.com  在网上查，在域名服务器上查找，udp协议查)
  ARP address resolater protocal 地址解析协议  （ip地址）

  NAT
    家用路由器
    网络地址转换
      DNAT
      SNAT
    端口转发
    内网可以主动连外网
    外网不能主动连内网
      除非设置了端口转发或DMZ
      对内网此乃构成了一定的保护

  * UDP （udp有可能丢包 对IP的简单封装）
  ```js
    sock = dgram.createSocket('udp4') // 创建IPv4端口对象  在IP上开一个端口

    sock.bind(portNumber) 
    sock.bind(12345) //绑定一个端口号

    sock.send(data, port, ip)

    // 需要设置 开启广播功能
    sock.setBroadcast(true)
    sock.send(data, '12345', '255.255.255.255') // udp 广播

    sock.addEventListener('message', (data, info) => {}) //tian'jian
    sock.on('message',(data,info) => { console.log(info.data); sock.send('hi', info.port.info.address) })
  ```
  ```js
    sock = dgram.createSocket('udp4');
    sock.bind(10010); 

    sock.on('message', console.log);//添加事件
    sock.addMembership('225.8.8.8'); // 加入频道
    sock.send(data, 10010, '225.8.8.8');//发送组播
    sock.send(data, 10010, '225.255.255.255'); //发送广播
    sock.setBroadcast(true)// 广播

    sock.addEventListener('message' (data, info) => {
      info // 发送者的相关信息， IP 端口 数据长度
      data  // 接收到的数据
    })

    sock.address() //获取自己的IP地址
  ```
  * TCP (transition control protocol  传输控制协议)
  ```js
    var net = require('net')

    serve = net.createServer() // 创建服务端

    serve.on('connection', conn => {   // serve对象触发connection事件
      consoe.log(conn.remoteAddress, conn.remotePort, 'comes in') // 收到一个连接，打印该链接的远程地址

      conn.write('将会把传来的数据转换成大写') // 发送

      conn.on('data', dat => { // connection 事件触发data事件
        conn.write(conn.remoteAddress) // 连接上收到数据，将数据打印出来
        conn.write(dat.toString().toUpperCase()) // 连接上收到数据，将数据打印出来
      })
      conn.on('error', () => {})
    }) // 监听事件 建立连接 当连接建立成功，触发函数  conn对象代表服务器与终端之间的连接

    <!-- server.listen(40080, '0.0.0.0') // 监听电脑上所有IP地址的40080端口  在特定的IP地址上监听（非所有的IP地址， 用其他的IP地址连接到该服务器，无法监听） -->
    server.listen(40080) 
  ```
  server = net('connection', conn => { console.log(conn.remoteAddress);  conn.write('hellow');conn.on('data'
,dat => {console.log(conn.remoteAddress, dat) }) });0;


练习1：
  * 
思考题1：
  <!-- icmp 协议 IP协议 arp协议 ETH协议（internet） 
  ping命令发送icmp协议（基于ip协议） IP协议基于ETH协议  ARP协议基于ETH协议
  目标ip/mask子网掩码 和pip按位与运算，结果相同在同一局域网中，尝试找到机器的mac地址，发送arp请求（广播），目标机器收到，回复并告知mac地址 后续通信使用mac地址，IP地址会填写到数据包中，即使在局域网中的通信，也是先封装（抽象）成网络层的通信，不管局域网或广域网的通信，上层的协议不会修改，都基于IP层。
  目标ip/mask子网掩码 和pip按位与运算（目标IP地址，自己的IP地址，与运行后）  ，结果不相同在广域网中，信息需要路由器转发。网关就是一台路由，至少有两个网口，它的功能就是转发数据。
  网络末端的普通用户的终端，他们的网关是家用路由器，把数据发给路由器即可。
  路由器，有路由表，自动生成，或设定。
  同一根网线上两端的IP地址是不一样的，IP地址给到网口，而非给到网线的。

  TTL（time to live）数据在网络路由器中能够被转发多少次（TTL只会被路由器改变）-->

  问题：
    查询计算机网络配置信息的命令是什么？
    ping命令做了什么？抓包查验证。
    什么是mac地址？
    交换机于集线器有什么区别？
    交换机的接口有mac地址吗？为什么？
    什么叫网管交换机？
    何为载波帧听多路访问？
    为何要使用曼彻斯特编码？
    为何要做时钟同步？
    网络与快递的相似之处体现在什么地方？
    为什么ip地址是按地区划分的？
    实验两台电脑直接使用网线连接，设置合适的ip地址后相互ping通。
    实验连接在同一交换机的电脑设置不同网络的ip地址是无法相互ping通。
    抓包查看并验证tracert的原理。

  讲解：
    查询计算机网络配置信息的命令是什么？
      Windows： ipconfig
      linux/mac：ifconfig（if 为 interface）

    什么是mac地址？
      media access control
      简称： 物理地址
      占六个字节， 是网卡出场时设置的唯一地址
      用于在局域网（直接链接的设置）间通信使用，将会出现在以太网帧的包头里
        因为局域网中多台设备可能连接到同一个总线，任何一个设备向网线上发送信息，其他所有设备都能收到，此时需要标明小时是发送给谁的

    交换机于集线器有什么区别？
      集线器是物理层设备
        集线器（最简单的放大电路）会将收到的信号从每个端口发送出去
      交换机是链路层设备
        交换机会记录每个网口链接的设备的mac地址
        交换机会根据收到的包的接收者mac地址将数据包从接收者链接的端口发送出去

    交换机的接口有mac地址吗？为什么？
      （交换机相当于一根总线 相当于中转站 每个网口不需要有mac地址）
      没有
      对于连接到交换机的网络设备来说，它会认为自己还连接的是总线或集线器

    路由器的接口有mac地址吗？为什么？
      有。路由器的每个接口都是由ip地址的，有ip地址必然需要有mac地址
      ip地址 mac地址

    什么叫网关交换机？ （电脑需要与网关直接通信，不能中转）
      带一定网关能力的交换机
        如mac地址或ip地址与端口绑定
        连接到某端口的设备只能声称自己有某mac地址和IP地址，一旦声称，拔掉网线之前是不能再更改的
      由于还可能会识别数据包中的网络层的信息，有些网关交换机也称为三层交换机

    何为载波帧听多路访问？
      载波侦听：设备再发送信息的时候同时侦听有无其他设备也在正在发送，如果有的话，双方会同时放弃此次的发送
      多路访问：指同一条线路或信道有多个设备同时使用

    为何要使用曼彻斯特编码或差分曼彻斯特编码？
      因为这两种编码中都会在每个时钟周期切换信号的跳变
      这种跳变实则隐含了时钟周期
      但是也会带来跳变次数的加倍，导致单位时间传输的数据极限减半

    为何要做时钟同步？
      因为通信的设备间时钟不可能完全一致

    网络与快递的相似之处体现在什么地方？
      数据包的中转
        数据包时通过若干设备慢慢中转到目的地的
        快递包裹也是中转到达
      IP地址与快递地址：
        IP地址中前缀类似愉快地地址中的省、市
      分层：
        快递公司为各种公司提供服务，快递公司本身依赖汽车，汽车依赖公路

    为什么ip地址是按地区划分的？
      大多数路由器在转发数据包的时候，不需要也不可能根据完整目的IP地址进行转发，而是只会根据目的的IP地址的前缀来转发
      就比必然到hi前缀相同或相似的目的IP地址的数据包被转发到相同或大致相同的方向，结果就是同一个地区的IP地址大致相同

    ping命令做了什么？抓包查验证。
      发送了一个类似“有人吗？”的数据包到目的ip，期待其回复
        这个信息是通过ICMP协议编码的
      统计收到回复时经过的时间，结果统计结果

    实验两台电脑直接使用网线连接，设置合适的ip地址后相互ping通。
    实验连接在同一交换机的电脑设置不同网络的ip地址是无法相互ping通。
    抓包查看并验证tracert的原理。
思考题2：
  <!-- DHCP dns VPN ipv6 
    DHCP （IP地址 子网掩码 网关 DNS服务器 都是IP） 连上以后发送广播，获取IP地址（自动获取）DHCP 基于UDP协议 基于IP 基于ETH（以太网）
    租约时间 分配IP地址 
    DNS（域名服务器） 为了IP地址起名用 
    hosts文件 单独指定哪个域名指向哪个IP地址（一般在开发的时候，用来把线上资源重新定向到我们自己的电脑，修改线上js的bug的时候
            另一个作用，把广告所在的服务器的域名指向自己的电脑地址来屏蔽广告。
    ）
    
   -->
  问题：
    如何理解VPN？它工作在哪一层？
    IP数据包是如何到达目地址的？
    IPv6如何在现行网络上工作？
    DHCP是什么？其协商过程是怎样的？为什么会有租约时间的限制？
    物理层、链路层、网络层分别主要关心的是什么？
    什么是MTU？典型值是多少？什么情况下其大小不是典型值？
    带宽与延迟分别代表什么？说出常见应用更关注带宽还是延迟。
    用手机流量连接教室vpn以实现查看我电脑上的共享文件。
    到阿里云申请一个域名并将一个子域名指向某ip地址。
    DNS服务是什么？其沟通过程是怎样的？为什么不能用域名的方法指定DNS服务器？能否在某台机器上改变一个域名的指向？如何操作？
    0.0.0.0与255.255.255.255这两个地址在不同情况代表什么？

  讲解：
    如何理解VPN？它工作在哪一层？
      相当于机器通过现有网络虚拟出一根网线插到了VPN服务器所在机房
        机器会多出一张虚拟的网卡，网卡还会获得ip地址
      网络层或链路层

    IP数据包是如何到达目地址的？
      通过中间路由器的转发
      (正确转发，需要路由表，由人配置，路由器之间 协议 之后得到)

    IPv6如何在现行网络上工作？
      IPv6 Over IPv4
      （IPv6 包含于Ipv4）

    DHCP是什么？其协商过程是怎样的？为什么会有租约时间的限制？
      Dynamic Host Configuration Protocal 动态主机配置协议
        DHCP是基于UDP的
      即主机自动获取ip地址配置信息的协议
      广播（协商过程）
      为什么会有租约时间的限制？
        因为设备在拔掉网络直接离开时，已经没有机会通过该网络了

    物理层、链路层、网络层分别主要关心的是什么？
      物理层关心01的正确送达与理解
      链路层关心的是直接由电缆连接的多个设备间的通信
      网络层关心网络中任意两台设备间的通信

    什么是MTU？典型值是多少？什么情况下其大小不是典型值？
      Max Transport Unit 最大传输单元（一个数据包最大的大小）
      以太网的MTU典型值是1500字节（传输的时候，数据值为该值抛去各层协议的头部）
      连接VPN的时候大小不是典型值

    带宽与延迟分别代表什么？说出常见应用更关注带宽还是延迟。
      带宽指每秒传输的数据量/类似于公路的宽度  XXX bps
      延迟(delay 时延) 数据到达目的地的时间/类似于公路的长度  XXX ms
      关注延迟的：游戏，语音通话，视频通话
      关注带宽的：直播，下载

    DNS服务是什么？其沟通过程是怎样的？为什么不能用域名的方法指定DNS服务器？能否在某台机器上改变一个域名的指向？如何操作？
      域名解析服务，即查询域名的ip地址的服务
      请求，响应
      因为如果用域名指定，这个域名得先被解析出来
      能，修改hosts文件

    0.0.0.0与255.255.255.255这两个地址在不同情况代表什么？
      0.0.0.0 可以不知道自己ip地址的时候代表自己的地址
        或在自己的电脑上使用时，代表自己电脑的所有地址
      255.255.255.255 代表广播地址

    用手机流量连接教室vpn以实现查看我电脑上的共享文件。
    到阿里云申请一个域名并将一个子域名指向某ip地址。
